local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer

getgenv().Functions = {
    AutoRebirthMachine = false,
    AutoBlowBubbles = false
}

local REBIRTH_INTERVAL = 3600
local Remote = require(ReplicatedStorage.Shared.Framework.Network.Remote)
local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)

local Window = Rayfield:CreateWindow({
    Name = "Bubble Gum Simulator",
    LoadingTitle = "BGS Auto Farm",
    LoadingSubtitle = "by Script Hub",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "BGSAutoFarm",
        FileName = "config"
    },
    Discord = {
        Enabled = false,
        Invite = "",
        RememberJoins = true
    },
    KeySystem = false
})

local MainTab = Window:CreateTab("Main", nil)
local MainSection = MainTab:CreateSection("Main Functions")

MainTab:CreateToggle({
    Name = "Auto Blow Bubbles",
    CurrentValue = false,
    Flag = "AutoBlowBubbles",
    
    Callback = function(Value)
        getgenv().Functions.AutoBlowBubbles = Value
        task.spawn(function()
            while Functions.AutoBlowBubbles do
                task.wait()
                Remote:FireServer("BlowBubble")
            end
        end)
    end
})

MainTab:CreateToggle({
    Name = "Auto Sell Bubbles",
    CurrentValue = false,
    Flag = "AutoSellBubbles",
    
    Callback = function(Value)
        getgenv().Functions.AutoSellBubbles = Value
        task.spawn(function()
            while Functions.AutoSellBubbles do
                task.wait()
                Remote:FireServer("SellBubble")
            end
        end)
    end
})

local RebirthTab = Window:CreateTab("Rebirth", nil)
local StatusSection = RebirthTab:CreateSection("Status")
local statusLabel = RebirthTab:CreateLabel("Status: Disabled")
local RebirthSection = RebirthTab:CreateSection("Rebirth Machine Settings")

local function getValidSecretPets()
    local validPets = {}
    
    local data = LocalData:Get()
    if not data or not data.Pets then
        warn("No pet data found")
        return validPets
    end
    
    for petGUID, petData in pairs(data.Pets) do
        if type(petData) == "table" then
            local petName = petData.Name or ""
            local isEquipped = petData.Equipped or false
            local isShiny = petData.Shiny or false
            local isMythic = petData.Mythic or false
            
            if petName == "Giant Bongo Kitty" and not isEquipped and not isShiny and not isMythic then
                table.insert(validPets, petGUID)
            end
        end
    end
    
    return validPets
end

local function useRebirthMachine()
    local validPets = getValidSecretPets()
    
    if #validPets < 5 then
        statusLabel:Set("Status: Not enough pets (" .. #validPets .. "/5)")
        Rayfield:Notify({
            Title = "Not Enough Pets",
            Content = "Need 5 pets, found: " .. #validPets,
            Duration = 3,
            Image = nil,
        })
        return false
    end
    
    local selectedPets = {}
    for i = 1, 5 do
        table.insert(selectedPets, validPets[i])
    end
    
    statusLabel:Set("Status: Attempting to use machine...")
    
    local success, result = pcall(function()
        return Remote:InvokeServer("UseRebirthMachine", selectedPets)
    end)
    
    task.wait(0.5)
    
    if success then
        statusLabel:Set("Status: Machine used successfully!")
        Rayfield:Notify({
            Title = "Success",
            Content = "Rebirth machine used with 5 pets!",
            Duration = 3,
            Image = nil,
        })
        return true
    else
        statusLabel:Set("Status: Machine failed - " .. tostring(result))
        Rayfield:Notify({
            Title = "Failed",
            Content = "Error: " .. tostring(result),
            Duration = 4,
            Image = nil,
        })
        return false
    end
end

RebirthTab:CreateToggle({
    Name = "Auto Rebirth Machine",
    CurrentValue = false,
    Flag = "AutoRebirthMachine",
    
    Callback = function(Value)
        getgenv().Functions.AutoRebirthMachine = Value
        task.spawn(function()
            while Functions.AutoRebirthMachine do
                useRebirthMachine()
                
                if Functions.AutoRebirthMachine then
                    for i = REBIRTH_INTERVAL, 0, -1 do
                        if not Functions.AutoRebirthMachine then break end
                        local minutes = math.floor(i / 60)
                        local seconds = i % 60
                        statusLabel:Set(string.format("Status: Next use in %02d:%02d", minutes, seconds))
                        task.wait(1)
                    end
                end
            end
            statusLabel:Set("Status: Disabled")
        end)
    end
})

local IntervalSlider = RebirthTab:CreateSlider({
    Name = "Machine Interval (minutes)",
    Range = {1, 120},
    Increment = 1,
    CurrentValue = 60,
    Flag = "MachineInterval",
    
    Callback = function(Value)
        REBIRTH_INTERVAL = Value * 60
        Rayfield:Notify({
            Title = "Interval Updated",
            Content = "Machine interval set to " .. Value .. " minutes",
            Duration = 2,
            Image = nil,
        })
    end
})

local InfoSection = RebirthTab:CreateSection("Information")

RebirthTab:CreateParagraph({
    Title = "How to Use",
    Content = "This script automatically uses the rebirth machine every hour using 5 Giant Bongo Kitty pets. Make sure you have at least 5 unequipped, non-shiny, non-mythic Giant Bongo Kitty pets in your inventory."
})

local UtilityTab = Window:CreateTab("Utility", nil)
local UtilitySection = UtilityTab:CreateSection("Script Control")

UtilityTab:CreateButton({
    Name = "Check Pet Count",
    Callback = function()
        local data = LocalData:Get()
        
        if not data then
            print("No LocalData found")
            Rayfield:Notify({
                Title = "Error",
                Content = "Could not access game data",
                Duration = 3,
                Image = nil,
            })
            return
        end
        
        print("=== PET DEBUG ===")
        print("Has Pets table:", data.Pets ~= nil)
        
        if data.Pets then
            local count = 0
            local bongoCats = 0
            local validBongoCats = 0
            
            for guid, pet in pairs(data.Pets) do
                count = count + 1
                if type(pet) == "table" and pet.Name == "Giant Bongo Kitty" then
                    bongoCats = bongoCats + 1
                    print("Found Bongo Cat:", guid)
                    print("  Equipped:", pet.Equipped or false)
                    print("  Shiny:", pet.Shiny or false)
                    print("  Mythic:", pet.Mythic or false)
                    
                    if not pet.Equipped and not pet.Shiny and not pet.Mythic then
                        validBongoCats = validBongoCats + 1
                    end
                end
            end
            
            print("Total pets:", count)
            print("Total Bongo Cats:", bongoCats)
            print("Valid Bongo Cats:", validBongoCats)
            
            Rayfield:Notify({
                Title = "Pet Count",
                Content = "Valid: " .. validBongoCats .. "\nTotal Bongo: " .. bongoCats .. "\nAll Pets: " .. count,
                Duration = 5,
                Image = nil,
            })
        else
            Rayfield:Notify({
                Title = "No Pets",
                Content = "Pets table not found in game data",
                Duration = 3,
                Image = nil,
            })
        end
    end,
})

UtilityTab:CreateButton({
    Name = "Use Machine Now",
    Callback = function()
        local success = useRebirthMachine()
        if success then
            Rayfield:Notify({
                Title = "Machine",
                Content = "Machine used successfully!",
                Duration = 3,
                Image = nil,
            })
        else
            Rayfield:Notify({
                Title = "Machine Failed",
                Content = "Could not use machine",
                Duration = 3,
                Image = nil,
            })
        end
    end,
})

Rayfield:LoadConfiguration()
